CREATE TABLE users(
	id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	username varchar(64) NOT NULL UNIQUE,
    	full_name varchar(255),
    	email varchar(255) NOT NULL UNIQUE,
    	phone varchar(255) NOT NULL UNIQUE,
    	password varchar(255) NOT NULL
);

CREATE TABLE personal_details(
	id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	user_id integer REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE,
	field text NOT NULL,
	academic_level varchar(255) NOT NULL
);

CREATE TABLE roles (
    id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name varchar(255) NOT NULL UNIQUE
);

CREATE TABLE user_roles (
    user_id integer REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE,
    role_id integer REFERENCES roles(id) ON UPDATE CASCADE,
    CONSTRAINT user_role_pkey PRIMARY KEY (user_id, role_id)
);

CREATE TABLE company_detail(
	id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	user_id integer REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE,
	name varchar(255) NOT NULL,
	focus_area text NOT NULL,
	address varchar(255) NOT NULL,
	email varhchar(255),
	country varchar(65),
	city varchar(65)
);

CREATE TABLE internship(
	id integer UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	company_id integer REFERENCES company_detail(id) ON UPDATE CASCADE ON DELETE CASCADE,
	name varchar(255) NOT NULL,
	closing_date timestamp NOT NULL,
	required_academic_level varchar(255) NOT NULL,
	description text,
	payment varchar(20),
	CONSTRAINT company_internshipname_pkey PRIMARY KEY(company_id,name)
);

CREATE TABLE field_of_study_required(
	internship_id integer REFERENCES internship(id) ON UPDATE CASCADE ON DELETE CASCADE,
	field varchar(255) NOT NULL,
	CONSTRAINT internship_field_pkey PRIMARY KEY(internship_id,field)
);

CREATE TABLE applications(
	internship_id integer REFERENCES internship(id) ON UPDATE CASCADE ON DELETE CASCADE,
	applicant_id integer REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE,
	applied_on timestamp NOT NULL,
	status varchar(30) NOT NULL,
	CONSTRAINT internship_applicant_pkey PRIMARY KEY(internship_id,applicant_id)
);